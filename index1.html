<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h1>โพสต์ล่าสุด</h1> 

    <button onclick="fetchAndDisplayPosts()">ดึงโพสต์</button> 

    <ul id="post-list"></ul> 
    <script> 

    // ประกาศฟังก์ชันเป็น async เพื่อให้สามารถใช้ await ได้ 

    async function fetchAndDisplayPosts() { 

        const postList = document.getElementById('post-list'); 

 

        // ใช้ try-catch เพื่อจัดการข้อผิดพลาด 

        try { 

            // 1. ส่งคำขอ GET ไปยัง API และรอ response 

            const response = await fetch('https://jsonplaceholder.typicode.com/posts?_limit=5'); 

 

            // 2. ตรวจสอบว่าการเรียก API สำเร็จหรือไม่ (สถานะ 200-299) 

            if (!response.ok) { 

                throw new Error(`การดึงข้อมูลล้มเหลว: ${response.status}`); 

            } 

 

            // 3. แปลงข้อมูล response เป็น JSON และรอจนกว่าจะเสร็จ 

            const posts = await response.json(); 

 

            // 4. นำข้อมูลที่ได้มาแสดงผลบนหน้าเว็บ 

            posts.forEach(post => { 

                const listItem = document.createElement('li'); 

                listItem.innerHTML = `<h3>${post.title}</h3><p>${post.body}</p>`; 

                postList.appendChild(listItem); 

            }); 

 

            console.log('ดึงข้อมูลและแสดงผลโพสต์สำเร็จแล้ว!'); 

 

        } catch (error) { 

            // 5. หากมีข้อผิดพลาดจะถูกจับที่นี่ 

            console.error('เกิดข้อผิดพลาดในการทำงาน:', error.message); 

            postList.innerHTML = '<li>ไม่สามารถโหลดข้อมูลได้ โปรดลองใหม่อีกครั้ง</li>'; 

        } 

    } 

    </script> 
</body>
</html>