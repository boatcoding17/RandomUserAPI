<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random User API Example</title>
    <!-- ส่วนตกแต่ง CSS -->
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; margin: 2em; background: #f8fafc; }
        h1 { color: #2d3748; }
        button { padding: 12px 28px; font-size: 1.1em; background: #4f46e5; color: #fff; border: none; border-radius: 6px; cursor: pointer; transition: background 0.2s; }
        button:hover { background: #6366f1; }
        #user-list { display: flex; flex-wrap: wrap; gap: 1.5em; margin-top: 2em; }
        .user-card { background: #fff; border-radius: 10px; box-shadow: 0 2px 8px rgba(44,62,80,0.07); padding: 1em; width: 220px; text-align: center; }
        .user-card img { border-radius: 50%; margin-bottom: 0.5em; }
        .user-card .name { font-weight: bold; color: #4f46e5; }
        #chart-container { max-width: 500px; margin: 2em auto; background: #fff; border-radius: 10px; box-shadow: 0 2px 8px rgba(44,62,80,0.07); padding: 2em; }
    </style>
    <!-- เรียกใช้งาน Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- เรียกใช้งาน Lodash -->
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
</head>
<body>
    <!-- ส่วนหัวข้อหลักของหน้าเว็บ -->
    <h1>Random User API ตัวอย่าง</h1>
    <!-- ปุ่มสำหรับดึงข้อมูลผู้ใช้ -->
    <button onclick="fetchAndDisplayUsers()">ดึงข้อมูลผู้ใช้</button>
    <!-- ส่วนแสดงรายชื่อผู้ใช้ -->
    <div id="user-list"></div>
    <!-- ส่วนแสดงกราฟ Chart -->
    <div id="chart-container">
        <canvas id="genderChart"></canvas>
    </div>
    <!-- ส่วน Script หลัก -->
    <script>
    // ตัวแปรสำหรับเก็บอินสแตนซ์ของ Chart
    let genderChartInstance = null;

    // ฟังก์ชันดึงข้อมูลผู้ใช้จาก API และแสดงผล
    async function fetchAndDisplayUsers() {
        const userList = document.getElementById('user-list');
        userList.innerHTML = '';
        try {
            const response = await fetch('https://randomuser.me/api/?results=8');
            if (!response.ok) throw new Error('Fetch failed');
            const data = await response.json();

            // ใช้ lodash groupBy เพื่อแยกเพศ
            const grouped = _.groupBy(data.results, 'gender');
            const male = grouped.male ? grouped.male.length : 0;
            const female = grouped.female ? grouped.female.length : 0;

            // วนลูปสร้างการ์ดผู้ใช้แต่ละคน
            data.results.forEach(user => {
                const card = document.createElement('div');
                card.className = 'user-card';
                card.innerHTML = `
                    <img src="${user.picture.medium}" alt="avatar">
                    <div class="name">${user.name.title} ${user.name.first} ${user.name.last}</div>
                    <div>${user.email}</div>
                    <div>${user.location.country}</div>
                    <div>เพศ: ${user.gender === 'male' ? 'ชาย' : 'หญิง'}</div>
                `;
                userList.appendChild(card);
            });
            // เรียกฟังก์ชันแสดงกราฟ
            renderGenderChart(male, female);
        } catch (e) {
            userList.innerHTML = '<div>ไม่สามารถโหลดข้อมูลได้</div>';
            renderGenderChart(0, 0);
        }
    }

    // ฟังก์ชันสำหรับแสดงกราฟสัดส่วนเพศ
    function renderGenderChart(male, female) {
        const ctx = document.getElementById('genderChart').getContext('2d');
        if (genderChartInstance) genderChartInstance.destroy();
        genderChartInstance = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['ชาย', 'หญิง'],
                datasets: [{
                    data: [male, female],
                    backgroundColor: ['#4f46e5', '#f472b6']
                }]
            },
            options: {
                plugins: {
                    legend: { display: true },
                    title: { display: true, text: 'สัดส่วนเพศของผู้ใช้' }
                }
            }
        });
    }
    </script>
</body>
</html>
